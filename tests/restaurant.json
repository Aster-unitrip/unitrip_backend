{
    "collection": "restaurants",
    "database": "unitrip",
    "dataSource": "RealmCluster",
    "pipeline": [
        {
            "$facet": {
                "docs": [
                    {
                        "$match": {
                            "meals": {
                                "$elemMatch": {
                                    "type": "\u5408\u83dc"
                                }
                            },
                            "is_display": true
                        }
                    },
                    {
                        "$lookup": {
                            "from": "restaurants_private",
                            "localField": "_id",
                            "foreignField": "public_id",
                            "as": "private"
                        }
                    },
                    {
                        "$unwind": {
                            "path": "$private",
                            "preserveNullAndEmptyArrays": true
                        }
                    },
                    {
                        "$addFields": {
                            "private.owned_by": {
                                "$ifNull": [
                                    "$private.owned_by",
                                    0
                                ]
                            }
                        }
                    },
                    {
                        "$match": {
                            "private.owned_by": {
                                "$in": [
                                    2,
                                    0
                                ]
                            }
                        }
                    },
                    {
                        "$project": {
                            "_id": 1,
                            "address_city": 1,
                            "address_town": 1,
                            "address": 1,
                            "name": 1,
                            "tel": 1,
                            "cost_per_person": 1,
                            "meals": 1,
                            "imgs": 1,
                            "experience": 1
                        }
                    },
                    {
                        "$limit": 10
                    }
                ],
                "count": [
                    {
                        "$match": {
                            "meals": {
                                "$elemMatch": {
                                    "type": "\u5408\u83dc"
                                }
                            },
                            "is_display": true
                        }
                    },
                    {
                        "$lookup": {
                            "from": "restaurants_private",
                            "localField": "_id",
                            "foreignField": "public_id",
                            "as": "private"
                        }
                    },
                    {
                        "$unwind": {
                            "path": "$private",
                            "preserveNullAndEmptyArrays": true
                        }
                    },
                    {
                        "$addFields": {
                            "private.owned_by": {
                                "$ifNull": [
                                    "$private.owned_by",
                                    0
                                ]
                            }
                        }
                    },
                    {
                        "$match": {
                            "private.owned_by": {
                                "$in": [
                                    2,
                                    0
                                ]
                            }
                        }
                    },
                    {
                        "$project": {
                            "_id": 1,
                            "address_city": 1,
                            "address_town": 1,
                            "address": 1,
                            "name": 1,
                            "tel": 1,
                            "cost_per_person": 1,
                            "meals": 1,
                            "imgs": 1,
                            "experience": 1
                        }
                    },
                    {
                        "$count": "totalCount"
                    }
                ]
            }
        },
        {
            "$unwind": {
                "path": "$count"
            }
        },
        {
            "$set": {
                "count": "$count.totalCount"
            }
        }
    ]
}