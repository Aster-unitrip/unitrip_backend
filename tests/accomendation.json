{
    "collection": "accomendations",
    "database": "unitrip",
    "dataSource": "RealmCluster",
    "pipeline": [
        {
            "$facet": {
                "docs": [
                    {
                        "$match": {
                            "room": {
                                "$all": [
                                    {
                                        "$elemMatch": {
                                            "holiday_price": {
                                                "$lte": 6000,
                                                "$gte": 1000
                                            }
                                        }
                                    }
                                ]
                            },
                            "is_display": true
                        }
                    },
                    {
                        "$lookup": {
                            "from": "accomendations_private",
                            "localField": "_id",
                            "foreignField": "public_id",
                            "as": "private"
                        }
                    },
                    {
                        "$unwind": {
                            "path": "$private",
                            "preserveNullAndEmptyArrays": true
                        }
                    },
                    {
                        "$addFields": {
                            "private.owned_by": {
                                "$ifNull": [
                                    "$private.owned_by",
                                    0
                                ]
                            }
                        }
                    },
                    {
                        "$match": {
                            "private.owned_by": {
                                "$in": [
                                    2,
                                    0
                                ]
                            }
                        }
                    },
                    {
                        "$project": {
                            "_id": 1,
                            "address_city": 1,
                            "address_town": 1,
                            "address": 1,
                            "name": 1,
                            "tel": 1,
                            "cost_per_person": 1,
                            "meals": 1,
                            "imgs": 1,
                            "room": 1,
                            "experience": "$private.experience"
                        }
                    },
                    {
                        "$limit": 10
                    }
                ],
                "count": [
                    {
                        "$match": {
                            "room": {
                                "$all": [
                                    {
                                        "$elemMatch": {
                                            "holiday_price": {
                                                "$lte": 6000,
                                                "$gte": 1000
                                            }
                                        }
                                    }
                                ]
                            },
                            "is_display": true
                        }
                    },
                    {
                        "$lookup": {
                            "from": "accomendations_private",
                            "localField": "_id",
                            "foreignField": "public_id",
                            "as": "private"
                        }
                    },
                    {
                        "$unwind": {
                            "path": "$private",
                            "preserveNullAndEmptyArrays": true
                        }
                    },
                    {
                        "$addFields": {
                            "private.owned_by": {
                                "$ifNull": [
                                    "$private.owned_by",
                                    0
                                ]
                            }
                        }
                    },
                    {
                        "$match": {
                            "private.owned_by": {
                                "$in": [
                                    2,
                                    0
                                ]
                            }
                        }
                    },
                    {
                        "$project": {
                            "_id": 1,
                            "address_city": 1,
                            "address_town": 1,
                            "address": 1,
                            "name": 1,
                            "tel": 1,
                            "cost_per_person": 1,
                            "meals": 1,
                            "imgs": 1,
                            "room": 1,
                            "experience": "$private.experience"
                        }
                    },
                    {
                        "$count": "totalCount"
                    }
                ]
            }
        },
        {
            "$unwind": {
                "path": "$count"
            }
        },
        {
            "$set": {
                "count": "$count.totalCount"
            }
        }
    ]
}