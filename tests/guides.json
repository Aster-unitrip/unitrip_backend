{
    "collection": "guides",
    "database": "unitrip",
    "dataSource": "RealmCluster",
    "pipeline": [
        {
            "$facet": {
                "docs": [
                    {
                        "$lookup": {
                            "from": "guides_private",
                            "localField": "_id",
                            "foreignField": "public_id",
                            "as": "private"
                        }
                    },
                    {
                        "$unwind": {
                            "path": "$private",
                            "preserveNullAndEmptyArrays": true
                        }
                    },
                    {
                        "$addFields": {
                            "private.owned_by": {
                                "$ifNull": [
                                    "$private.owned_by",
                                    0
                                ]
                            }
                        }
                    },
                    {
                        "$match": {
                            "private.owned_by": {
                                "$in": [
                                    2,
                                    0
                                ]
                            }
                        }
                    },
                    {
                        "$project": {
                            "_id": 1,
                            "gender": 1,
                            "name": 1,
                            "categories": 1,
                            "languages": 1,
                            "imgs": 1,
                            "fee": 1,
                            "cell_phone": 1,
                            "private": 1
                        }
                    },
                    {
                        "$limit": 10
                    }
                ],
                "count": [
                    {
                        "$lookup": {
                            "from": "guides_private",
                            "localField": "_id",
                            "foreignField": "public_id",
                            "as": "private"
                        }
                    },
                    {
                        "$unwind": {
                            "path": "$private",
                            "preserveNullAndEmptyArrays": true
                        }
                    },
                    {
                        "$addFields": {
                            "private.owned_by": {
                                "$ifNull": [
                                    "$private.owned_by",
                                    0
                                ]
                            }
                        }
                    },
                    {
                        "$match": {
                            "private.owned_by": {
                                "$in": [
                                    2,
                                    0
                                ]
                            }
                        }
                    },
                    {
                        "$project": {
                            "_id": 1,
                            "gender": 1,
                            "name": 1,
                            "categories": 1,
                            "languages": 1,
                            "imgs": 1,
                            "fee": 1,
                            "cell_phone": 1,
                            "private": 1
                        }
                    },
                    {
                        "$count": "totalCount"
                    }
                ]
            }
        },
        {
            "$unwind": {
                "path": "$count"
            }
        },
        {
            "$set": {
                "count": "$count.totalCount"
            }
        }
    ]
}